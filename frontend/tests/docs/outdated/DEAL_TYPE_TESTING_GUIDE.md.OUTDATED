# Deal Type Testing Guide

## ï¿½ï¿½ **CURRENT STATUS: 8/8 STEPS WORKING FOR SIMPLE DEAL TYPE**

### âœ… **WORKING INFRASTRUCTURE**

#### **Authentication Requirements**
- **Production URL**: `https://fairplay-nil.vercel.app`
- **Test Credentials**: `test1@test.edu` / `testuser`
- **Authentication State**: Saved in `playwright/.auth/user.json`
- **Project**: Use `chromium-auth` for protected routes

#### **Test Framework**
- **Main File**: `frontend/tests/step-by-step-deal-wizard.spec.js` (clean version)
- **Complete End-to-End Flow**: All 8 steps working consistently
- **Comprehensive Logging**: Emoji indicators for easy debugging
- **Screenshot Capture**: On failures for visual debugging
- **Robust Error Handling**: Fallback mechanisms and validation

## ðŸ“ **CURRENT ARCHITECTURE & FILES TO USE**

### **ðŸŽ¯ PRIMARY TEST FILE (USE THIS)**
```
frontend/tests/step-by-step-deal-wizard.spec.js
```
- **Status**: Active development (clean version)
- **Purpose**: Complete end-to-end testing of Simple deal type
- **Progress**: 8/8 steps working (100% completion)
- **Contains**: All working patterns and complete flow
- **Command**: `npx playwright test step-by-step-deal-wizard.spec.js --project=chromium-auth`

### **ðŸ“š DOCUMENTATION FILES (REFERENCE THESE)**
```
frontend/tests/PLAYWRIGHT_SUMMARY.md          # Current status overview
frontend/tests/PLAYWRIGHT_PROGRESS_NOTES.md   # Detailed progress and patterns
frontend/tests/DEAL_TYPE_TESTING_GUIDE.md     # This file - Testing guide
frontend/tests/PLAYWRIGHT_FINDINGS.md         # Technical discoveries
frontend/tests/PLAYWRIGHT_CONTEXT.md          # Context and next steps
```

### **ðŸ”§ CONFIGURATION FILES (DON'T MODIFY)**
```
frontend/playwright.config.js                 # Playwright configuration
frontend/global-setup.js                      # Authentication setup
frontend/package.json                         # Test scripts
```

### **ðŸ“Š TEST RESULTS (GENERATED)**
```
frontend/test-results/                        # Screenshots and error logs
frontend/playwright-report/                   # HTML test reports
```

### **ðŸš« ARCHIVED FILES (DON'T USE)**
```
frontend/tests/archive/step-by-step-deal-wizard.spec.js.old  # Old version with syntax errors
frontend/tests/deal-type-diagnostic.spec.js   # Old diagnostic tests
frontend/tests/deal-type-comparison.spec.js   # Old comparison tests
```

## ðŸš€ **WORKING STEP-BY-STEP PATTERNS**

### **âœ… Step 0: Social Media**
```javascript
// âœ… Working implementation:
await page.goto('https://fairplay-nil.vercel.app/dashboard');
// Handle login if needed
await page.locator('input[placeholder*="Instagram"]').fill('@testuser');
await page.locator('input[placeholder*="followers"]').fill('1000');
await page.locator('button:has-text("Continue")').click();
```

### **âœ… Step 1: Deal Terms**
```javascript
// âœ… Working implementation:
await page.locator('input[placeholder*="Nike"], input[placeholder*="John"]').fill('Test Deal');
// Handle green popup if present
const greenPopup = page.locator('text="Social media confirmed"');
if (await greenPopup.count() > 0) {
  await page.locator('button[aria-label="Close"]').click();
}
await page.locator('button:has-text("Next")').click();
```

### **âœ… Step 2: Payor Info**
```javascript
// âœ… Working implementation:
await page.locator('text="Business"').first().click();
await page.locator('input[placeholder*="Nike"], input[placeholder*="John"]').fill('Test Company Inc.');
await page.locator('button:has-text("Next")').click();
```

### **âœ… Step 3: Activities**
```javascript
// âœ… Working implementation:
await page.locator('text="Social Media"').first().click();
await page.locator('button:has-text("Next")').click();
```

### **âœ… Step 4: Social Media Activity Form**
```javascript
// âœ… Working implementation:
await page.locator('text="Instagram"').first().click();
// Click plus buttons to enable form
const allButtons = page.locator('button');
if (await allButtons.count() >= 3) {
  await allButtons.nth(2).click();
}
await page.locator('button:has-text("Continue")').click();
```

### **âœ… Step 5: Compliance**
```javascript
// âœ… Working implementation:
const noOptions = page.locator('text="No"');
for (let i = 0; i < await noOptions.count(); i++) {
  await noOptions.nth(i).click();
}
await page.locator('button:has-text("Continue")').click();
```

### **âœ… Step 6: Compensation**
```javascript
// âœ… Working implementation:
await page.locator('input[type="number"]').first().fill('1000');
await page.locator('select').first().selectOption({ index: 1 });
// Fill additional fields if needed
const additionalInputs = page.locator('input');
for (let i = 0; i < await additionalInputs.count(); i++) {
  const input = additionalInputs.nth(i);
  const value = await input.inputValue();
  if (!value && await input.isVisible()) {
    await input.fill('100');
  }
}
await page.locator('button:has-text("Next")').click();
```

### **âœ… Step 7: Review & Submit**
```javascript
// âœ… Working implementation:
const submitButton = page.locator('button:has-text("Submit Deal"), button:has-text("Submit")');
await submitButton.waitFor({ state: 'visible', timeout: 10000 });
await submitButton.click();
// Verify submission success
expect(page.url()).toMatch(/\/add\/deal\/submission-success\/\d+/);
```

## ðŸ”§ **WORKING ELEMENT SELECTION STRATEGIES**

### **Chakra UI Compatible Selectors**
```javascript
// âœ… Radio buttons
page.locator('text="Business"').first()

// âœ… Dynamic placeholders
page.locator('input[placeholder*="Nike"], input[placeholder*="John"]')

// âœ… Button selection
page.locator('button:has-text("Next")').last()

// âœ… Multiple option selection
page.locator('text="No"')

// âœ… Icon-based selection
page.locator('button').filter({ has: page.locator('svg[data-lucide="plus"]') })
```

### **Form Validation Patterns**
```javascript
// âœ… Check button enabled state
const isNextButtonEnabled = await nextButton.isEnabled();
if (hasNextButton && isNextButtonEnabled) {
  await nextButton.click();
}
```

### **Error Handling Patterns**
```javascript
// âœ… Comprehensive logging
console.log('ðŸŽ¯ STEP X: Testing...');
console.log('âœ… Successfully completed...');
console.log('âŒ Error occurred...');
console.log('ðŸ“¸ Screenshot saved...');

// âœ… Screenshot capture on failure
await page.screenshot({ path: 'test-results/step-x-failure.png' });
```

## ðŸ“‹ **TEST DATA REQUIREMENTS**

### **Authentication**
- **Email**: `test1@test.edu`
- **Password**: `testuser`
- **Account**: Must exist in production database

### **Form Data**
- **Social Media**: `@testuser` / `1000` followers
- **Deal Nickname**: `Test Simple Deal`
- **Payor Info**: `Test Company Inc.` (Business)
- **Activities**: Social Media selected
- **Compensation**: $1000 (amount + schedule + description)

## ðŸŽ¯ **DEAL TYPE DIFFERENCES**

### **Simple Deal**
- **Steps**: 0-7 (Social Media â†’ Review & Submit)
- **Ending**: Submission success page
- **Features**: Basic deal tracking with complete flow

### **Clearinghouse Deal**
- **Steps**: 0-7 + NIL Go prediction
- **Ending**: Clearinghouse result page
- **Features**: Includes NIL Go clearinghouse prediction

### **Valuation Deal**
- **Steps**: 0-7 + valuation analysis
- **Ending**: Valuation result page
- **Features**: Includes fair market value analysis

## ðŸš€ **QUICK START COMMANDS**

```bash
# Run complete flow test
npx playwright test step-by-step-deal-wizard.spec.js --project=chromium-auth

# Run with detailed output
npx playwright test step-by-step-deal-wizard.spec.js --project=chromium-auth --reporter=line

# Run with timeout
npx playwright test step-by-step-deal-wizard.spec.js --project=chromium-auth --timeout=120000

# View test reports
npx playwright show-report
```

## ðŸ“Š **SUCCESS METRICS**

- **8/8 steps working** for Simple deal type (100% completion)
- **Robust test infrastructure** established
- **Production environment** successfully tested
- **Authentication system** working reliably
- **Element selection strategies** proven effective
- **Error handling and debugging** comprehensive
- **Complete end-to-end flow** working consistently

## ðŸŽ¯ **NEXT STEPS**

### **Option 1: Complete Other Deal Types**
- Apply working patterns to Clearinghouse deal type
- Apply working patterns to Valuation deal type
- Create comprehensive test suite for all deal types

### **Option 2: Enhance Test Coverage**
- Add more edge cases and error scenarios
- Improve test reliability and performance
- Add visual regression testing

### **Option 3: Create Comprehensive Test Suite**
- Document all working patterns for future reference
- Create a robust test suite covering all working functionality
- Add performance benchmarks

## ðŸ“ **KEY FILES**

- `frontend/tests/step-by-step-deal-wizard.spec.js` - Main test file (clean version)
- `frontend/tests/PLAYWRIGHT_SUMMARY.md` - Updated summary
- `frontend/tests/PLAYWRIGHT_PROGRESS_NOTES.md` - Progress notes
- `frontend/tests/PLAYWRIGHT_FINDINGS.md` - Technical findings

**Last Updated**: January 2025  
**Status**: 100% Complete (8/8 steps working)  
**Next Focus**: Complete other deal types or comprehensive testing 